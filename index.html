<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>尿不湿比价器</title>
<style>
:root{--bd:#e5e7eb;--text:#222;--muted:#666;--pri:#2563eb;--err:#dc2626}
*{box-sizing:border-box}
body{margin:0;background:#fff;color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;font-size:14px}
header{max-width:1100px;margin:0 auto;padding:14px 16px 8px}
h1{margin:0;font-size:18px;font-weight:600}
.sub{color:var(--muted);font-size:12px;margin-top:4px}
main{max-width:1100px;margin:0 auto;padding:0 16px 24px}
.toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:12px 0}
button{cursor:pointer;border:1px solid var(--bd);background:#fff;color:#111;border-radius:6px;padding:7px 10px;font-size:14px}
button.primary{background:var(--pri);border-color:var(--pri);color:#fff}
button.danger{border-color:#f3d2d2;color:#fff;background:var(--err)}
.hint{color:var(--muted);font-size:12px;margin-left:auto}
.table-wrap{overflow:auto;border:1px solid var(--bd);border-radius:8px}
table{border-collapse:collapse;width:100%;min-width:900px}
th,td{border-bottom:1px solid var(--bd);padding:8px 10px;vertical-align:middle}
th{position:sticky;top:0;background:#fafafa;font-weight:600}
th.right, td.right{text-align:right}
input[type=text],input[type=number]{width:100%;padding:6px 8px;border:1px solid var(--bd);border-radius:4px;font-size:14px;background:#fff;color:#111}
input[type=number]{text-align:right}
.mono{font-variant-numeric:tabular-nums}
.del{background:#fff;border-color:#f3d2d2;color:#b91c1c}
.chip{display:inline-block;padding:2px 6px;border-radius:5px;background:#eef2ff;color:#3730a3;font-size:12px}
.link{cursor:pointer;text-decoration:underline}
</style>
</head>
<body>
<header>
<h1>尿不湿比价器</h1>
<div class="sub">列：品牌，型号，片/包，包数，单价（¥/包），总价（¥），单片价格（¥/片），备注。输入即计算；可排序。</div>
</header>

<main>
<div class="toolbar">
<button class="primary" id="addRowBtn">新增一行</button>
<button id="sortBtn" data-dir="asc">按“单片价格”排序 ▾</button>
<button class="danger" id="clearBtn">清空列表</button>
<span class="hint">提示：总价 = 单价 × 包数；单片价格 = 单价 ÷ 片/包</span>
</div>

<div class="table-wrap">
<table id="tbl">
<thead>
<tr>
<th style="width:140px">品牌</th>
<th style="width:220px">型号</th>
<th class="right" style="width:90px">片/包</th>
<th class="right" style="width:90px">包数</th>
<th class="right" style="width:120px">单价（¥/包）</th>
<th class="right" style="width:120px">总价（¥）</th>
<th class="right" style="width:140px" id="thPPU" data-dir="asc">单片价格（¥/片） ▾</th>
<th>备注</th>
<th style="width:70px">操作</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</main>

<script>
(function(){
const $ = s => document.querySelector(s);
const tbody = $('#tbody');

function esc(s){ return (s||'').replace(/[<>&]/g, c=>({'<':'&lt;','>':'&gt;','&':'&amp;'}[c])); }
function toNum(v){ const n = parseFloat(v); return Number.isFinite(n) ? n : 0; }
function toInt(v){ const n = Math.floor(parseFloat(v)); return Number.isFinite(n) ? n : 0; }
function fmtMoney(n){ return Number.isFinite(n) ? n.toFixed(2) : '—'; }
function fmtUnit(n){ if(!Number.isFinite(n)) return '—'; return n.toFixed(4).replace(/0+$/,'').replace(/\.$/,''); }

function computeRow(tr){
const ppp = Math.max(0, toInt(tr.querySelector('input[name=ppp]').value));
const packs = Math.max(0, toInt(tr.querySelector('input[name=packs]').value));
const unit = Math.max(0, toNum(tr.querySelector('input[name=unit]').value));
const total = unit * packs;
const ppu = ppp > 0 ? (unit / ppp) : NaN;

tr.querySelector('.cell-total').textContent = '¥' + fmtMoney(total);
tr.querySelector('.cell-ppu').innerHTML = `<span class="chip">¥${fmtUnit(ppu)}</span>`;
tr.dataset.total = Number.isFinite(total) ? total : '';
tr.dataset.ppu = Number.isFinite(ppu) ? ppu : '';
}

function onInput(e){
const tr = e.target.closest('tr');
if(!tr) return;
computeRow(tr);
}

function addRow(init={}){
const tr = document.createElement('tr');
tr.innerHTML = `
<td><input type="text" name="brand" placeholder="品牌" value="${esc(init.brand||'')}"></td>
<td><input type="text" name="model" placeholder="型号" value="${esc(init.model||'')}"></td>
<td class="right"><input type="number" name="ppp" min="1" step="1" placeholder="片/包" value="${Number.isFinite(init.ppp)? init.ppp : ''}"></td>
<td class="right"><input type="number" name="packs" min="1" step="1" placeholder="包数" value="${Number.isFinite(init.packs)? init.packs : ''}"></td>
<td class="right"><input type="number" name="unit" min="0" step="0.01" placeholder="¥/包" value="${Number.isFinite(init.unit)? init.unit : ''}"></td>
<td class="right mono cell-total">—</td>
<td class="right mono cell-ppu"><span class="chip">—</span></td>
<td><input type="text" name="note" placeholder="备注" value="${esc(init.note||'')}"></td>
<td><button type="button" class="del btn-del">删除</button></td>
`;
tr.addEventListener('input', onInput);
tr.querySelector('.btn-del').addEventListener('click', ()=> tr.remove());
// Enter 在最后一列时新增行
tr.addEventListener('keydown', (e)=>{
if(e.key==='Enter'){
const inputs = Array.from(tr.querySelectorAll('input'));
const idx = inputs.indexOf(document.activeElement);
if(idx === inputs.length - 1){ e.preventDefault(); const r = addRow(); r.querySelector('input[name=brand]').focus(); }
}
});
tbody.appendChild(tr);
computeRow(tr);
return tr;
}

function sortByPPU(dir='asc'){
const rows = Array.from(tbody.querySelectorAll('tr'));
// 先确保数值最新
rows.forEach(r=>computeRow(r));
rows.sort((a,b)=>{
const A = parseFloat(a.dataset.ppu);
const B = parseFloat(b.dataset.ppu);
const aVal = Number.isFinite(A) ? A : Number.POSITIVE_INFINITY;
const bVal = Number.isFinite(B) ? B : Number.POSITIVE_INFINITY;
return dir==='asc' ? (aVal - bVal) : (bVal - aVal);
});
rows.forEach(r=>tbody.appendChild(r));
}

// 控件
$('#addRowBtn').addEventListener('click', ()=> {
const r = addRow();
r.querySelector('input[name=brand]').focus();
});

$('#clearBtn').addEventListener('click', ()=>{
if(confirm('确定清空列表吗？')){
tbody.innerHTML = '';
addRow().querySelector('input[name=brand]').focus();
}
});

$('#sortBtn').addEventListener('click', (e)=>{
const btn = e.currentTarget;
const dir = btn.getAttribute('data-dir') === 'asc' ? 'desc' : 'asc';
btn.setAttribute('data-dir', dir);
btn.textContent = `按“单片价格”排序 ${dir==='asc'?'▾':'▴'}`;
sortByPPU(dir);
});

$('#thPPU').addEventListener('click', (e)=>{
const th = e.currentTarget;
const dir = th.getAttribute('data-dir') === 'asc' ? 'desc' : 'asc';
th.setAttribute('data-dir', dir);
th.innerHTML = `单片价格（¥/片） ${dir==='asc'?'▾':'▴'}`;
sortByPPU(dir);
});

// 初始三行，方便直接录入
addRow(); addRow(); addRow();
})();
</script>
</body>
</html>